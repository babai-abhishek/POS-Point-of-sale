AWSTemplateFormatVersion: '2010-09-09'
Description: CloudFormation template to create ECS Cluster,ECS task definition(ECR repo is already created at before).

# Resources Section (part-1)
Resources:
#  # Create ECR Repository
#  MyECRRepository:
#    Type: AWS::ECR::Repository
#    Properties:
#      RepositoryName: my-demo-ecr-repo-cft
#      ImageScanningConfiguration:
#        scanOnPush: true
#        EncryptionConfiguration:
#          EncryptionType: AES256  # Default encryption


  # New ECS Cluster Create
  MyECSCluster:
    Type: AWS::ECS::Cluster
    Properties:
      ClusterName: pos-inventory-ecs-cluster-cft

  # New Task Definition create
  MyTaskDefinition:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: pos-inventory-task-definition-cft
      NetworkMode: awsvpc
      RequiresCompatibilities:
        - FARGATE
      Cpu: '256'  # Adjust CPU as needed
      Memory: '512'  # Adjust memory as needed
      ExecutionRoleArn: arn:aws:iam::590183897518:role/ecsTaskExecutionRole
      TaskRoleArn: arn:aws:iam::590183897518:role/pos-rds-role
      ContainerDefinitions:
        - Name: pos-inventory-docker-container-cft
          Image: !Sub "${AWS::AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/my-demo-ecr-repo:latest"
          Essential: true
          Environment:
            - Name: SECRET_NAME
              Value: "rds!db-affb1879-e19b-4bd8-a2e2-c3ea8c6a035d"

          PortMappings:
            - ContainerPort: 9082
              Protocol: tcp
